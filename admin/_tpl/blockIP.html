<script type="text/javascript">
$(document).ready(function(){
	$form = $("form[name=blockIPForm]");
	//컨트롤 체크박스 클릭시 리스트의 모든 체크박스 선택
	$("._cnum_allCheck",$form).click(function(e){
		e.preventDefault();
		$("input[name='cnum[]']",$form).each(function(){
			if($(this).is(":checked")==false){
				$(this).attr({checked:true});
			}else{
				$(this).attr({checked:false});
			}
		});
	});
	//차단 추가 버튼 클릭시 입력 박스를 보임
	$("._add_btn").toggle(
		function(){ $("._blacklist_add",$form).show(); },
		function(){ $("._blacklist_add",$form).hide(); }
	);
	//차단 입력폼에서 완료 버튼 클릭시 추가를 요청함
	$("#SM_add_btn",$form).click(function(){
		if(confirm("추가 하시겠습니까?")){
			$("input[name='type']",$form).val("new");
			$.ajax({
				type		:	"POST",
				url			:	__URL_PATH__+"admin/blockIP.submit.php",
				data		:	$form.serialize(),
				cache		:	false,
				async		:	false,
				dataType	:	"HTML",
				success		:	function(msg){
									switch(msg){
										case "<!--error::null_ip-->" :
											alert("차단할 IP를 입력하세요.");
											break;
										case "<!--error::null_memo-->" :
											alert("차단 사유를 입력하세요.");
											break;
										case "<!--error::have_ip-->" :
											alert("이미 추가된 IP입니다.");
											break;
										case "<!--success::1-->" :
											alert("성공적으로 추가 되었습니다.");
											window.document.location.reload();
											break;
										default :
											alert(msg);
									}
								}
			}); 
		}
	});
	//선택 삭제 버튼 클릭시 해당 리스트를 삭제 요청함
	$("._delete_btn").click(function(e){
		e.preventDefault();
		if($(":checkbox[name=cnum[]]:checked",$form).length==0){
			alert("하나의 항목도 선택되지 않았습니다.");
			return false;
		}
		if(confirm("정말로 삭제하시겠습니까?")==true){
			$("input[name='type']",$form).val("delete");
			$.ajax({
				type		:	"POST",
				url			:	__URL_PATH__+"admin/blockIP.submit.php",
				cache		:	false,
				data		:	$form.serialize(),
				async		:	false,
				dataType	:	"HTML",
				success		:	function(msg){
									if(msg.substr(0,8)=="Success_"){
										var b_count = msg.substr(8);
										alert("총 "+b_count+"개의 차단을 삭제하였습니다.");
										document.location.reload();
									}else{
										alert(msg);
									}
								}
			});
		}
	});
});
</script>
<div id="layout">
	<?php include_once __DIR_PATH__."admin/header.inc.php"; ?>
	<article class="wrap">
		<?php include_once __DIR_PATH__."admin/sidebar.inc.php"; ?>
		<div class="content">
			<div class="titleBar">	
				<h2>IP 접속 차단</h2>
			</div>
			<div class="cont">
				<div class="__article_notice">
					IP 차단된 회원을 관리 하세요.
				</div>
				<div class="contArticle">
					<form name="blockIPForm">
						<table cellpadding="0" cellspacing="0" class="__article_table_read _blacklist_add" style="margin-bottom:10px; display:none;">
							<thead>
								<tr>
									<th colspan="3">차단 아이피 추가</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th style="width:100px;">차단할 IP</th>
									<td><input type="text" name="ip" /></td>
									<td rowspan="2" style="width:100px; text-align:center;">
										<input type="button" id="SM_add_btn" class="__btn_submit _add_btn" />
									</td>
								</tr>
								<tr>
									<th style="width:100px;">차단 사유</th>
									<td>
										<input type="text" name="memo" style="width:400px;" />
									</td>
								</tr>
							</tbody>
						</table>
						
						<input type="hidden" name="p" value="blockIP" />
						<input type="hidden" name="type" value="" />
						<div class="__article_table_search">
							<div class="__btn_ch_area">
								<a href="#" class="__btn_ch_selectAll _cnum_allCheck" title="전체선택"></a>
								<a href="#" class="__btn_ch_delete _delete_btn" title="선택 삭제"></a>
							</div>
							<select name="where">
								<option value="ip" [where_value_ip]>아이피</option>
								<option value="memo" [where_value_memo]>차단사유</option>
							</select>
							<input type="text" name="keyword" value="[keyword_value]" style="width:150px;" />
							<input type="submit" class="submit" value="" />
						</div>
						
						<table cellpadding="0" cellspacing="0" class="__article_table">
							<thead>
								<tr>
									<th class="___f" style="width:35px;"><input type="checkbox" class="_cnum_allCheck" /></th>
									<th style="width:200px; text-align:left;">차단 IP</th>
									<th style="text-align:left;">차단사유</th>
									<th class="___l" style="width:150px;">등록일</th>
								</tr>
							</thead>
							<tbody>
								[{loop_start}]
								<tr>
									<td style="text-align:center;"><input type="checkbox" name="cnum[]" value="[idno]" /></td>
									<td style="text-align:center; font-weight:bold; text-align:left;">[ip]</td>
									<td style="text-align:center; text-align:left;">[memo]</td>
									<td class="___number">[regdate]</td>
								</tr>
								[{loop_end}]
								[{not_content_start}]
								<tr>
									<td colspan="4">접속 차단된 IP 내역이 존재하지 않습니다.</td>
								</tr>
								[{not_content_end}]
							</tbody>
						</table>
						[paging_area]
					</form>
					<div class="__article_btnArea">
						<input type="button" class="__btn_blockIp_add _add_btn" />
						<a href="./" class="__btn_cancel"></a>
					</div>
				</div>
			</div>
		</div>
	</article>
	<?php include __DIR_PATH__."admin/footer.inc.php"; ?>
</div>